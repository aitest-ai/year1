<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºèƒ½å¤¥ä¼´ - è²“å’ªè€å¸« (é€£ç·šæ¸¬è©¦ç‰ˆ)</title>
    <style>
        /* ç°¡å–®çš„ CSS è®“ä»‹é¢çœ‹èµ·ä¾†åƒå€‹æ¨£å“ */
        body {
            font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            background: white;
            width: 90%;
            max-width: 500px;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .cat-avatar {
            font-size: 80px;
            margin-bottom: 10px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        h1 { color: #333; margin: 0; font-size: 1.5rem; }
        p.subtitle { color: #666; font-size: 0.9rem; margin-top: 5px; }

        .control-panel {
            background: #eef2f5;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }

        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        
        select, textarea, input {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒæ’ç ´å¯¬åº¦ */
        }

        textarea { height: 80px; font-family: monospace; font-size: 0.85rem; }

        button {
            width: 100%;
            background-color: #4CAF50; /* Green */
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover { background-color: #45a049; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }

        .chat-bubble {
            position: relative;
            background: #fff3cd; /* é»ƒè‰²å°è©±æ¡† */
            border: 2px solid #ffeeba;
            padding: 15px;
            border-radius: 15px;
            margin-top: 20px;
            min-height: 60px;
            display: flex;
            align-items: center;
        }

        .chat-bubble::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 0 10px 10px 10px;
            border-style: solid;
            border-color: transparent transparent #ffeeba transparent;
        }

        .status {
            text-align: center;
            font-size: 0.8rem;
            margin-top: 10px;
            color: #888;
        }

        .error { color: red; }
        .success { color: green; }

    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <div class="cat-avatar">ğŸ±â€ğŸ’»</div>
            <h1>è²“å’ªè€å¸« AI æ¸¬è©¦çµ‚ç«¯</h1>
            <p class="subtitle">Scratch æƒ…ç·’åµæ¸¬èˆ‡å¼•å°ç³»çµ± MVP</p>
        </div>

        <div class="control-panel">
            <label for="emotion-select">1. æ¨¡æ“¬å­¸ç”Ÿæƒ…ç·’ (Simulate Emotion):</label>
            <select id="emotion-select">
                <option value="neutral">ğŸ˜ å¹³éœ (Neutral)</option>
                <option value="happy">ğŸ˜„ é–‹å¿ƒ (Happy)</option>
                <option value="sad">ğŸ˜¢ é›£é/æŒ«æŠ˜ (Sad)</option>
                <option value="angry">ğŸ˜¡ ç”Ÿæ°£ (Angry)</option>
                <option value="surprised">ğŸ˜² é©šè¨ (Surprised)</option>
            </select>

            <label for="code-input">2. ç›®å‰çš„ç¨‹å¼ç©æœ¨ (JSON çµæ§‹):</label>
            <textarea id="code-input">
{
  "block": "repeat_loop",
  "times": 9,
  "inside": "move_10_steps"
}</textarea>

            <label for="user-message">3. å­¸ç”Ÿæ±‚åŠ©è¨Šæ¯:</label>
            <input type="text" id="user-message" value="è€å¸«ï¼Œæˆ‘çš„è¿´åœˆå¥½åƒæ€ªæ€ªçš„ï¼Ÿ" placeholder="è¼¸å…¥ä½ æƒ³å•çš„è©±...">
            
            <button id="send-btn">å‘¼å«è²“å’ªè€å¸« (Call AI)</button>
        </div>

        <div class="chat-bubble">
            <span id="response-text">å–µï¼Ÿè«‹æŒ‰ä¸‹æŒ‰éˆ•ï¼Œæˆ‘æ‰æœƒé†’ä¾†å–”ï¼</span>
        </div>
        
        <div class="status" id="status-text">æº–å‚™å°±ç·’</div>
    </div>

    <script>
        // =========================================================
        // â˜…â˜…â˜… è«‹å°‡ä¸‹æ–¹çš„ç¶²å€æ›æˆæ‚¨å‰›å‰› GAS éƒ¨ç½²å‡ºä¾†çš„ç¶²å€ â˜…â˜…â˜…
        // æ ¼å¼é€šå¸¸æ˜¯ https://script.google.com/macros/s/XXXXX/exec
        // =========================================================
        const GAS_API_URL = "æ‚¨çš„_GAS_WEB_APP_URL_è«‹è²¼åœ¨é€™è£¡"; 

        const sendBtn = document.getElementById('send-btn');
        const responseText = document.getElementById('response-text');
        const statusText = document.getElementById('status-text');

        sendBtn.addEventListener('click', () => {
            // 0. æª¢æŸ¥ç¶²å€æœ‰æ²’æœ‰å¡«å¯«
            if (GAS_API_URL.includes("è«‹è²¼åœ¨é€™è£¡")) {
                alert("è«‹å…ˆç”¨ç­†è¨˜æœ¬æ‰“é–‹ index.htmlï¼ŒæŠŠ GAS_API_URL æ›æˆæ‚¨çš„éƒ¨ç½²ç¶²å€ï¼");
                return;
            }

            // 1. é–ä½æŒ‰éˆ•é˜²æ­¢é€£é»
            sendBtn.disabled = true;
            sendBtn.innerText = "è²“å’ªè€å¸«æ€è€ƒä¸­...";
            statusText.innerText = "æ­£åœ¨é€£ç·šåˆ° Google é›²ç«¯å¤§è…¦...";
            statusText.className = "status";
            responseText.style.opacity = "0.5"; // è®Šæ·¡è¡¨ç¤ºè®€å–ä¸­

            // 2. æ”¶é›†è³‡æ–™
            const payload = {
                emotion: document.getElementById('emotion-select').value,
                code: JSON.parse(document.getElementById('code-input').value || "{}"),
                message: document.getElementById('user-message').value
            };

            // 3. ç™¼é€è«‹æ±‚ (Fetch)
            // æŠ€å·§ï¼šä½¿ç”¨ text/plain é¿é–‹ CORS Preflight æª¢æŸ¥
            fetch(GAS_API_URL, {
                method: "POST",
                body: JSON.stringify(payload),
                headers: {
                    "Content-Type": "text/plain;charset=utf-8"
                }
            })
            .then(response => response.json()) // GAS å›å‚³çš„ä¸€å®šè¦æ˜¯ JSON
            .then(data => {
                console.log("æ”¶åˆ°å›æ‡‰:", data);
                
                if (data.status === "success") {
                    // æˆåŠŸï¼šé¡¯ç¤ºè²“å’ªè€å¸«çš„è©±
                    responseText.innerText = data.message;
                    responseText.style.color = "#333";
                    statusText.innerText = "é€£ç·šæˆåŠŸï¼(å»¶é²: " + new Date().toLocaleTimeString() + ")";
                    statusText.classList.add("success");
                } else {
                    // é‚è¼¯éŒ¯èª¤
                    responseText.innerText = "ç³»çµ±éŒ¯èª¤ï¼š" + data.message;
                    statusText.classList.add("error");
                }
            })
            .catch(error => {
                console.error("é€£ç·šå¤±æ•—:", error);
                responseText.innerText = "å—šå—š... é€£ä¸åˆ°ä¼ºæœå™¨ã€‚è«‹æª¢æŸ¥ï¼š\n1. GAS ç¶²å€æ˜¯å¦æ­£ç¢ºï¼Ÿ\n2. GAS éƒ¨ç½²æ¬Šé™æ˜¯å¦è¨­ç‚ºã€Œä»»ä½•äººã€ï¼Ÿ";
                statusText.innerText = "é€£ç·šå¤±æ•— (Check Console)";
                statusText.classList.add("error");
            })
            .finally(() => {
                // è§£é–æŒ‰éˆ•
                sendBtn.disabled = false;
                sendBtn.innerText = "å‘¼å«è²“å’ªè€å¸« (Call AI)";
                responseText.style.opacity = "1";
            });
        });
    </script>
</body>
</html>
