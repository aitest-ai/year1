<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç¬¬ä¸€å¹´ï¼šæƒ…ç·’åµæ¸¬èˆ‡æ¼¸é€²å¼å›é¥‹å­¸ç¿’ç³»çµ±</title>
    
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* =========================================
           UI é¢¨æ ¼è¨­å®š (ä¿æŒåŸæœ‰çš„æ·±è‰²ç§‘æŠ€é¢¨)
           ========================================= */
        :root { 
            --bg-color: #050505; 
            --panel-bg: #101010; 
            --accent: #00e5ff; /* ç¬¬ä¸€å¹´æ”¹ç”¨è—è‰²ç³»å€åˆ† */
            --accent-dim: #004d55; 
            --danger: #ff3333; 
            --text: #e0e0e0; 
            --border: #333; 
        }
        @font-face {
            font-family: 'Iansui';
            src: url('https://cdn.jsdelivr.net/fontsource/fonts/iansui@latest/chinese-traditional-400-normal.woff2') format('woff2');
        }

        body { 
            background: var(--bg-color); 
            color: var(--text); 
            font-family: 'Iansui','Microsoft JhengHei', sans-serif; 
            margin: 0; 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
        }
        
        /* å·¦å´åµæ¸¬é¢æ¿ */
        .panel-left { 
            width: 300px; 
            background: var(--panel-bg); 
            border-right: 1px solid var(--border); 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
        }
        .header { color: var(--accent); font-size: 1.2em; font-weight: bold; margin-bottom: 15px; }
        .cam-box { 
            width: 100%; height: 200px; background: #000; 
            border: 2px solid var(--accent); border-radius: 6px; 
            overflow: hidden; margin-bottom: 10px; position: relative;
        }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        .status-box { background: #1a1a1a; padding: 10px; border-radius: 6px; font-size: 0.9em; }
        .val { font-weight: bold; color: var(--accent); }
        .stress-bar-bg { height: 6px; background: #333; margin-top: 5px; border-radius: 3px; }
        .stress-bar { height: 100%; width: 0%; background: var(--accent); transition: width 0.5s; }

        /* å³å´ä¸»æ“ä½œå€ */
        .panel-right { flex: 1; display: flex; flex-direction: column; padding: 20px; overflow: hidden; }
        
        /* åˆ†é æŒ‰éˆ• (åªä¿ç•™å­¸ç¿’èˆ‡ä½œæ¥­) */
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { 
            background: #222; border: 1px solid #444; color: #aaa; 
            padding: 10px 20px; cursor: pointer; border-radius: 4px; 
            transition: 0.3s; flex: 1; text-align: center;
        }
        .tab-btn.active { background: var(--accent-dim); color: white; border-color: var(--accent); }
        
        .content-area { display: none; flex: 1; flex-direction: column; overflow-y: auto; }
        .content-area.active { display: flex; }

        /* å½±ç‰‡å€ */
        .video-container { position: relative; padding-bottom: 56.25%; height: 0; border: 1px solid #444; margin-bottom: 15px; }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

        /* ç¨‹å¼ç·¨è¼¯å€ */
        .editor-box { display: flex; flex-direction: column; height: 300px; border: 1px solid #333; margin-bottom: 10px; }
        .code-area { flex: 1; background: #0c0c0c; color: #ddd; padding: 10px; border: none; font-family: monospace; resize: none; font-size: 14px; }
        .output-area { height: 80px; background: #000; color: #aaa; padding: 10px; border-top: 1px solid #333; font-family: monospace; overflow-y: auto; }

        /* åº•éƒ¨ AI èŠå¤©å®¤ */
        #chat-panel { height: 180px; border-top: 1px solid #333; background: #080808; display: flex; flex-direction: column; padding: 10px; }
        #chat-msgs { flex: 1; overflow-y: auto; margin-bottom: 10px; font-size: 0.9em; }
        .msg { padding: 5px 10px; margin-bottom: 5px; border-radius: 4px; max-width: 90%; }
        .msg.ai { color: var(--accent); background: #002222; border-left: 3px solid var(--accent); }
        .msg.user { color: white; background: #333; align-self: flex-end; margin-left: auto; }

        .btn-action { background: var(--accent-dim); color: white; border: 1px solid var(--accent); padding: 8px 15px; cursor: pointer; border-radius: 4px; }
        .btn-action:hover { background: var(--accent); color: black; }

        /* æ¼¸é€²å¼å›é¥‹å½ˆçª— (ä¾æ“š Source 225) */
        .hint-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 2000; display: none; 
            justify-content: center; align-items: center; 
        }
        .hint-box { 
            background: #151515; width: 400px; padding: 20px; 
            border: 2px solid var(--accent); border-radius: 10px; text-align: center;
            box-shadow: 0 0 30px rgba(0, 229, 255, 0.2);
        }
    </style>
</head>
<body>

    <div id="hint-overlay" class="hint-overlay">
        <div class="hint-box">
            <h2 style="color:var(--accent);">ğŸ‘‹ éœ€è¦å¹«å¿™å—ï¼Ÿ</h2>
            <p id="hint-msg">åµæ¸¬åˆ°æ‚¨ä¼¼ä¹æœ‰äº›å›°æƒ‘ï¼ŒAI å¤¥ä¼´å¯ä»¥æä¾›å”åŠ©å–”ï¼</p>
            <div id="hint-content" style="text-align: left; background: #222; padding: 10px; margin: 10px 0; min-height: 50px; color: #fff;">
                (é»æ“Šä¸‹æ–¹æŒ‰éˆ•ç²å–æç¤º)
            </div>
            <div style="display: flex; justify-content: space-around;">
                <button class="btn-action" onclick="getNextHint()">ğŸ’¡ çµ¦æˆ‘ä¸€é»æç¤º</button>
                <button class="btn-action" style="background:#333; border-color:#555;" onclick="closeHint()">ğŸ¤” æˆ‘å†æƒ³æƒ³</button>
            </div>
        </div>
    </div>

    <div class="panel-left">
        <div class="header">ç¬¬ä¸€å¹´è¨ˆç•«ç³»çµ±</div>
        <div style="color:#666; font-size:0.8em; margin-bottom:10px;">ID: <span id="student-id">S112001</span></div>
        
        <div class="cam-box"><video id="video" autoplay muted playsinline></video></div>
        
        <div class="status-box">
            <div>æƒ…ç·’: <span id="emo-val" class="val">åµæ¸¬ä¸­...</span></div>
            <div style="margin-top:5px;">å°ˆæ³¨åº¦/ç‹€æ…‹: <span id="state-val" style="color:#aaa;">æ­£å¸¸</span></div>
            
            <div style="margin-top:10px; font-size:0.8em; color:#888;">è² é¢æƒ…ç·’ç´¯ç© (è§¸ç™¼ AI)</div>
            <div class="stress-bar-bg"><div id="stress-bar" class="stress-bar"></div></div>
        </div>

        <div style="flex:1; margin-top:15px; overflow-y:auto; font-family:monospace; font-size:0.7em; color:#555;" id="log-box">
            [System] Init...
        </div>
    </div>

    <div class="panel-right">
        <div class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('learning')">1. æ•™æå­¸ç¿’ (Video)</button>
            <button class="tab-btn" onclick="switchTab('assignment')">2. å–®å…ƒä½œæ¥­ (Assignment)</button>
        </div>

        <div id="tab-learning" class="content-area active">
            <h2 id="lesson-title">å–®å…ƒä¸€ï¼šPython åŸºç¤èˆ‡è¿´åœˆ</h2>
            <div class="video-container"><div id="youtube-player"></div></div>
            <div style="background:#1a1a1a; padding:15px; border-radius:6px;">
                <h3>ğŸ“œ æœ¬é€±æ•™æé‡é» [cite: 153]</h3>
                <p>1. è®Šæ•¸èˆ‡è³‡æ–™å‹æ…‹ (int, str)<br>2. æ¢ä»¶åˆ¤æ–· (if-else)<br>3. è¿´åœˆçµæ§‹ (for, while)</p>
                <button class="btn-action" onclick="switchTab('assignment')">å­¸ç¿’å®Œç•¢ï¼Œå‰å¾€ä½œæ¥­ â¡</button>
            </div>
        </div>

        <div id="tab-assignment" class="content-area">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>ğŸ“ ä½œæ¥­é¡Œç›®ï¼šè¨ˆç®—å®Œç¾æ•¸</h3>
                <button class="btn-action" onclick="triggerHintManually()" style="font-size:0.8em;">ğŸ†˜ ä¸»å‹•æ±‚æ•‘</button>
            </div>
            <p style="background:#222; padding:10px; border-left:3px solid var(--accent);">
                [é¡Œç›®] è«‹å¯«ä¸€å€‹ç¨‹å¼ï¼Œåˆ—å‡º 1 åˆ° 1000 ä¹‹é–“çš„æ‰€æœ‰ã€Œå®Œç¾æ•¸ã€ã€‚<br>
                (å®Œç¾æ•¸ï¼šè©²æ•¸çš„æ‰€æœ‰æ­£å› æ•¸å’Œç­‰æ–¼è©²æ•¸æœ¬èº«ï¼Œä¾‹å¦‚ 6 = 1+2+3)
            </p>
            
            <div class="editor-box">
                <textarea id="code-editor" class="code-area" placeholder="# è«‹åœ¨æ­¤è¼¸å…¥ Python ç¨‹å¼ç¢¼...">
# è¨ˆç®—å®Œç¾æ•¸
n = 1000
for i in range(1, n+1):
    # è«‹åœ¨æ­¤å®Œæˆç¨‹å¼ç¢¼...
    pass
</textarea>
                <div id="output" class="output-area">ç­‰å¾…åŸ·è¡Œ...</div>
            </div>
            
            <div style="display:flex; gap:10px;">
                <button class="btn-action" onclick="runPython()">â–¶ åŸ·è¡Œç¨‹å¼</button>
                <button class="btn-action" style="background:#28a745; border-color:#28a745;" onclick="submitAssignment()">âœ… ç¹³äº¤ä½œæ¥­</button>
            </div>
        </div>

        <div id="chat-panel">
            <div id="chat-msgs">
                <div class="msg ai">å—¨ï¼æˆ‘æ˜¯ä½ çš„ AI å­¸ç¿’å¤¥ä¼´ã€‚å¦‚æœä½ åœ¨å¯«ä½œæ¥­æ™‚é‡åˆ°å›°é›£ï¼Œæˆ–è€…æƒ…ç·’æ„Ÿåˆ°ç„¦æ…®ï¼Œæˆ‘æœƒä¸»å‹•å‡ºä¾†å”åŠ©ä½ å–”ï¼</div>
            </div>
            <div style="display:flex; gap:10px;">
                <input id="chat-input" style="flex:1; background:#222; border:1px solid #444; color:white; padding:5px;" placeholder="è¼¸å…¥å•é¡Œ...">
                <button class="btn-action" onclick="sendChat()">ç™¼é€</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase è¨­å®š (è«‹æ›¿æ›ç‚ºæ‚¨çš„çœŸå¯¦ Configï¼Œæ­¤è™•ç‚ºç¬¬ä¸€å¹´è¨ˆç•«çš„è³‡æ–™åº«çµæ§‹)
        // ç¬¬ä¸€å¹´åªéœ€è¨˜éŒ„ï¼šå­¸ç¿’æ­·ç¨‹ (Behavior)ã€æƒ…ç·’æ•¸æ“š (Emotion) 
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
             apiKey: "AIzaSyBgx03WUCJhe3ymWhecEYfiyShmcy9bCkg", // ç¯„ä¾‹ Keyï¼Œè«‹æ›å›æ‚¨çš„
             projectId: "code-a1ef3"
        };
        
        // ç°¡å–®çš„é˜²å‘†ï¼Œå¦‚æœæ²’æœ‰ Config å°±ä¸å ±éŒ¯
        let db = null;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
        } catch(e) { console.log("Firebase Init Skipped"); }

        window.logToCloud = async (type, data) => {
            if(!db) return;
            try {
                await addDoc(collection(db, "year1_records"), {
                    studentId: "S112001",
                    type: type,
                    data: data,
                    timestamp: new Date()
                });
                console.log("Logged:", type);
            } catch(e) { console.error("Log Error", e); }
        };
    </script>

    <script>
        // ============================================
        // æ ¸å¿ƒé‚è¼¯ï¼šç¬¬ä¸€å¹´è¨ˆç•«åŠŸèƒ½
        // ============================================

        // æ¨¡æ“¬çš„èª²ç¨‹è¨­å®š (Source 153, 159)
        const ASSIGNMENT_DATA = {
            hints: [
                "æç¤º 1ï¼šä½ éœ€è¦å…©å±¤è¿´åœˆã€‚å¤–å±¤è·‘ 1 åˆ° 1000ï¼Œå…§å±¤ç”¨ä¾†æ‰¾å› æ•¸ã€‚",
                "æç¤º 2ï¼šæ‰¾å› æ•¸å¯ä»¥ç”¨å–é¤˜æ•¸é‹ç®— (%)ã€‚å¦‚æœ num % i == 0ï¼Œä»£è¡¨ i æ˜¯å› æ•¸ã€‚",
                "æç¤º 3 (ç­”æ¡ˆçµæ§‹)ï¼š\nsum = 0\nfor j in range(1, i):\n  if i % j == 0: sum += j\nif sum == i: print(i)"
            ]
        };
        let currentHintLevel = 0;
        let pyodide = null;
        let isFaceLoaded = false;
        let stressLevel = 0; // æ¨¡æ“¬è² é¢æƒ…ç·’ç´¯ç©
        let chatHistory = [];
        
        // GAS API (ç”¨æ–¼ AI å°è©±)
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzkAH1B96FAMUhSf-n6ET5x8h8BXtXpxgIApmQraqk39rIZOhgUuOi94zmy1AuZMXAqXg/exec";

        async function init() {
            // 1. åˆå§‹åŒ– Pyodide
            try {
                pyodide = await loadPyodide();
                // ä¿®æ­£ Python input 
                await pyodide.runPythonAsync(`
import js, builtins
def custom_input(p=""):
    return js.prompt(p)
builtins.input = custom_input
                `);
                document.getElementById('output').innerText = "Python ç’°å¢ƒå°±ç·’ã€‚";
            } catch(e) { document.getElementById('output').innerText = "Python è¼‰å…¥ä¸­..."; }

            // 2. åˆå§‹åŒ– Face API (Module 1) 
            const MODEL_URL = 'https://justadudewhohacks.github.io/face-api.js/models';
            try {
                await faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL);
                await faceapi.nets.faceExpressionNet.loadFromUri(MODEL_URL);
                isFaceLoaded = true;
                startVideo();
            } catch(e) { console.log("FaceAPI Error", e); }
        }

        async function startVideo() {
            const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
            const videoEl = document.getElementById('video');
            videoEl.srcObject = stream;
            videoEl.addEventListener('play', () => {
                setInterval(detectEmotion, 1000); // æ¯ç§’åµæ¸¬ä¸€æ¬¡
            });
        }

        // æƒ…ç·’åµæ¸¬å¾ªç’° [cite: 217]
        async function detectEmotion() {
            if(!isFaceLoaded) return;
            const videoEl = document.getElementById('video');
            const detections = await faceapi.detectAllFaces(videoEl, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();
            
            if(detections.length > 0) {
                const expressions = detections[0].expressions;
                // æ‰¾å‡ºæ•¸å€¼æœ€é«˜çš„æƒ…ç·’
                const topEmo = Object.keys(expressions).reduce((a, b) => expressions[a] > expressions[b] ? a : b);
                document.getElementById('emo-val').innerText = topEmo;

                // æ ¹æ“š Source 45, 46: é—œæ³¨ æ†¤æ€’(angry), æ²®å–ª(sad/disgusted), ç„¦æ…®(fearful)
                // è‹¥åµæ¸¬åˆ°è² é¢æƒ…ç·’ï¼Œå¢åŠ å£“åŠ›å€¼
                if(['sad', 'angry', 'fearful', 'disgusted'].includes(topEmo)) {
                    stressLevel += 10;
                    document.getElementById('state-val').innerText = "åµæ¸¬åˆ°è² å‘æƒ…ç·’";
                    document.getElementById('state-val').style.color = "red";
                } else {
                    stressLevel = Math.max(0, stressLevel - 2); // æ­£å‘æˆ–ä¸­æ€§å‰‡ç·©è§£
                    document.getElementById('state-val').innerText = "å­¸ç¿’ç‹€æ³è‰¯å¥½";
                    document.getElementById('state-val').style.color = "#00e5ff";
                }
                
                updateStressBar();
                
                // è¨˜éŒ„åˆ°å­¸ç¿’æ­·ç¨‹ (Module 6)
                if(window.logToCloud) window.logToCloud("EMOTION_LOG", { emotion: topEmo, stress: stressLevel });
            }
        }

        function updateStressBar() {
            const bar = document.getElementById('stress-bar');
            bar.style.width = Math.min(100, stressLevel) + "%";
            
            // è§¸ç™¼ AI ä»‹å…¥é‚è¼¯ (Source 225)
            // ç•¶æ”¶åˆ°å­¸ç¿’è€…æƒ…ç·’ç‚ºè² å‘è³‡è¨Šæ™‚ï¼ŒAIæ™ºæ…§å¤¥ä¼´å°‡å•Ÿå‹•è©¢å•...
            if(stressLevel >= 80) {
                stressLevel = 0; // é‡ç½®ä»¥å…é‡è¤‡è§¸ç™¼
                showHintOverlay();
            }
        }

        // é¡¯ç¤ºæ¼¸é€²å¼å›é¥‹å½ˆçª— 
        function showHintOverlay() {
            document.getElementById('hint-overlay').style.display = 'flex';
            document.getElementById('hint-content').innerText = "(é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä»¥ç²å–ç¬¬ " + (currentHintLevel + 1) + " éšæ®µæç¤º)";
            // è¨˜éŒ„ AI ä»‹å…¥è¡Œç‚º
            if(window.logToCloud) window.logToCloud("AI_INTERVENTION", { type: "negative_emotion_trigger" });
        }

        function closeHint() {
            document.getElementById('hint-overlay').style.display = 'none';
        }

        // æ¼¸é€²å¼æç¤ºé‚è¼¯ (Source 225: æ¯å€‹æç¤ºéƒ½æœƒæ¯”å‰ä¸€å€‹æç¤ºæä¾›æ›´å¤šçš„ä¿¡æ¯)
        function getNextHint() {
            const hintBox = document.getElementById('hint-content');
            if(currentHintLevel < ASSIGNMENT_DATA.hints.length) {
                hintBox.innerText = ASSIGNMENT_DATA.hints[currentHintLevel];
                currentHintLevel++;
                
                // åŒæ­¥ç™¼é€çµ¦ AI èŠå¤©å®¤
                addMsg('ai', `[ä¸»å‹•ä»‹å…¥] åµæ¸¬åˆ°æ‚¨å¯èƒ½å¡é—œäº†ï¼Œæˆ‘æä¾›äº†ä¸€å€‹æç¤ºçµ¦æ‚¨ï¼š\n${ASSIGNMENT_DATA.hints[currentHintLevel-1]}`);
            } else {
                hintBox.innerText = "é€™å·²ç¶“æ˜¯æœ€å¾Œçš„æç¤ºå›‰ï¼è©¦è‘—åŸ·è¡Œçœ‹çœ‹å§ã€‚";
            }
        }
        
        function triggerHintManually() {
            showHintOverlay();
        }

        // åŸ·è¡Œ Python
        async function runPython() {
            const code = document.getElementById('code-editor').value;
            const outEl = document.getElementById('output');
            outEl.innerText = "åŸ·è¡Œä¸­...";
            try {
                // é‡å° stdout
                pyodide.setStdout({ batched: (msg) => outEl.innerText += msg + "\n" });
                await pyodide.runPythonAsync(code);
                outEl.innerText += "\n[åŸ·è¡ŒçµæŸ]";
                
                // è¨˜éŒ„è§£é¡Œè¡Œç‚º (Module 6)
                if(window.logToCloud) window.logToCloud("CODE_RUN", { code: code });
            } catch(e) {
                outEl.innerText = "éŒ¯èª¤:\n" + e;
                // éŒ¯èª¤ä¹Ÿæ˜¯ä¸€ç¨®è² é¢åé¥‹ï¼Œå¯èƒ½å¢åŠ å£“åŠ›
                stressLevel += 5; 
                updateStressBar();
            }
        }

        function submitAssignment() {
            alert("ä½œæ¥­å·²ç¹³äº¤ï¼(æ¨¡æ“¬)");
            if(window.logToCloud) window.logToCloud("ASSIGNMENT_SUBMIT", { code: document.getElementById('code-editor').value });
        }

        // Tab åˆ‡æ›
        window.switchTab = function(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.content-area').forEach(c => c.classList.remove('active'));
            
            if(tab === 'learning') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('tab-learning').classList.add('active');
            } else {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('tab-assignment').classList.add('active');
            }
        }

        // AI èŠå¤©åŠŸèƒ½ (Module 2)
        async function sendChat() {
            const input = document.getElementById('chat-input');
            const msg = input.value;
            if(!msg) return;
            
            addMsg('user', msg);
            input.value = "";
            
            // å‘¼å« GAS (Gemini)
            try {
                const res = await fetch(GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors', // ç°¡å–®ç•¥é CORSï¼Œå¯¦éš›å°ˆæ¡ˆéœ€è™•ç†
                    body: JSON.stringify({
                        type: 'CALL_GEMINI',
                        prompt: `ä½ æ˜¯ä¸€å€‹ç¨‹å¼è¨­è¨ˆåŠ©æ•™ã€‚å­¸ç”Ÿæ­£åœ¨å­¸ç¿’ Pythonã€‚å­¸ç”Ÿå•ï¼š${msg}ã€‚è«‹ç”¨å¼•å°çš„æ–¹å¼å›ç­”ï¼Œä¸è¦ç›´æ¥çµ¦ç­”æ¡ˆã€‚`
                    })
                });
                // æ¨¡æ“¬ AI å›æ‡‰ (å› ç‚º no-cors æ‹¿ä¸åˆ°å›å‚³å€¼ï¼Œé€™é‚Šç”¨å‡å›æ‡‰æ¼”ç¤º)
                setTimeout(() => {
                    addMsg('ai', "é€™æ˜¯ä¸€å€‹å¥½å•é¡Œï¼é—œæ–¼ " + msg + "ï¼Œä½ å¯ä»¥è©¦è‘—æ€è€ƒè®Šæ•¸çš„å®šç¾©æ–¹å¼...");
                }, 1000);
            } catch(e) {
                addMsg('ai', "é€£ç·šéŒ¯èª¤ï¼Œç„¡æ³•å›æ‡‰ã€‚");
            }
        }

        function addMsg(role, text) {
            const box = document.getElementById('chat-msgs');
            const div = document.createElement('div');
            div.className = `msg ${role}`;
            div.innerText = text;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }

        // è¼‰å…¥ YouTube API
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        
        window.onYouTubeIframeAPIReady = function() {
            new YT.Player('youtube-player', {
                height: '100%', width: '100%',
                videoId: 'PqFKRqpHrjw', // ç¯„ä¾‹å½±ç‰‡ ID
                events: {
                    'onStateChange': (e) => {
                        if(e.data == 1) { // Playing
                            if(window.logToCloud) window.logToCloud("VIDEO_PLAY", {});
                        }
                    }
                }
            });
        }

        // å•Ÿå‹•
        init();

    </script>
</body>
</html>
